<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for?(:title) ? yield(:title) : 'babylon-online.org' %></title>
    <%= csrf_meta_tags %>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body id="page-top">
    <nav id="mainNav" class="navbar navbar-<%= current_page?(root_url) ? 'custom' : 'default' %> navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" style="border: none; margin-top: 0; margin-bottom: 0;" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <%= fa_icon('bars 2x') %>
          </button>
          <%= link_to 'babylon-online.org', root_url, class: "navbar-brand" %>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-left">
            <%= content_tag :p, fa_icon('user', text: "Signed in as #{link_to current_user.name, (current_user.profile ? current_user.profile : new_profile_path)}".html_safe), class: 'navbar-text', style: 'margin-left: 15px;' if user_signed_in? %>
          </ul>
          <%= content_tag :ul, class: "nav navbar-nav navbar-right" do %>
            <li><%= link_to 'Explore', explore_path %></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <% for entry in @nav_blogs.where(type: 'About').order('position') do %>
                  <%= content_tag :li, link_to(entry.title, entry) %>
                <% end %>
                <li role="separator" class="divider"></li>
                <%= content_tag :li, link_to('All postings in this section', abouts_path) %>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Blog posts <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <% for entry in @nav_blogs.where(type: 'Post').order('position').limit(8) do %>
                  <%= content_tag :li, link_to(entry.title, entry) %>
                <% end %>
                <li role="separator" class="divider"></li>
                <%= content_tag :li, link_to('All postings in this section', posts_path) %>
              </ul>
            </li>
            <li><%= link_to 'News', novelities_path %></li>
            <li><%= link_to fa_icon('search'), search_path %></li>
          <% end if @nav_blogs %>        
        </div>
      </div>
    </nav>

    <% flash.each do |message_type, message| %>
      <%= javascript_tag "toastr['#{ message_type == 'notice' ? 'info' : (message_type == 'alert' ? 'warning' : message_type) }']('#{message}')" %>
    <% end %>

    <% if current_page?(root_url) %>
      <%= yield %>
    <% else %>
      <div class="container-fluid" style="margin: 60px 0 100px 0;">
        <%= content_tag :ol, class: 'breadcrumb' do %>
          <%= yield(:breadcrumbs) %>
        <% end if content_for?(:breadcrumbs) %>

        <div class="row">
          <div class="col-sm-7 col-md-8 main">
            <%= content_tag :div, class: "page-header" do %>
              <h1 class="">
                <%= yield(:title) if content_for?(:title) %>
                <div class="pull-right">
                  <%= yield(:buttons) if content_for?(:buttons) %>
                </div>
              </h1>
              <%= content_tag :p, yield(:subline), class: 'text-muted' if content_for?(:subline) %>
            <% end if content_for?(:buttons) || content_for?(:title) && @show_title %>
            <%= yield %>
          </div>
          <div class="col-sm-5 col-md-4 sidebar">
            <%= yield(:sidebar) if content_for?(:sidebar) %>
          </div>
        </div>
      </div>
      
      
    <% end %>


    <div class="footer" id="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-10 col-lg-10 col-sm-12">
            <p id="footer-info-copyright" class="text-muted">
              Der Inhalt ist unter der Lizenz „Creative Commons Attribution/Share Alike“ verfügbar; 
              Informationen zu den Urhebern und zum Lizenzstatus eingebundener Mediendateien (etwa 
              Bilder oder andere Dokumente) können im Regelfall durch Anklicken dieser abgerufen werden. 
              Möglicherweise unterliegen die Inhalte jeweils zusätzlichen Bedingungen. Durch die Nutzung 
              dieser Website erklären Sie sich mit den Nutzungsbedingungen und der Datenschutzrichtlinie 
              einverstanden.
            </p>
            <p class="text-muted">
              &copy; <%= Time.now.strftime("%Y") %> <%= link_to 'babylon-online.org', root_path %>
              <small>(v. <%= APP_VERSION %>)</small>
            </p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <ul id="footer-doc-links" class="nav nav-pills"> 
              <li><%= link_to "Contact", contact_path %></li>
              <li><%= link_to "Help", help_path %></li>
              <li><%= link_to "Imprint", imprint_path %></li>
              <li><%= link_to "Developers", api_path %></li>
    
              <% if current_user %>
                <li class="resp-right"><%= link_to "Sign Out", destroy_user_session_path, method: :delete %></li>
                <%= content_tag :li, link_to("Settings", edit_user_registration_path), class: "resp-right" if can?(:show, current_user) %>
                <%= content_tag :li, link_to('Manage Users', users_path), class: 'resp-right' if can?(:index, User) %> 
              <% else %>
                <li class="resp-right"><%= link_to "Sign in", new_user_session_path %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
