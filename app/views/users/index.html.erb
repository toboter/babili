<% title "Registered users" %>

<% content_for :breadcrumbs do %>
  <%= content_tag :li, yield(:title), class: 'active' %>
<% end %>

<p class="text-muted">
  Users listed here are registered and have the ability to read everything. Admins may assign other users a new role. You cannot change your own role, that is why you are missing in the table.
<p>

<table class="table table-simple">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
	    <th>Roles</th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
      <%= content_tag :tr, id: "edit_user_#{user.id}" do %>
        <td>
          <%= content_tag :strong, user.try(:person).try(:namespace).try(:slug) %>
        </td>
        <td>
          <%= user.email %>
        </td>
        <%= content_tag :td do %>
          <%= simple_form_for user, url: approve_user_path(user), remote: true, html: { id: "approve_user_#{user.id}", class: 'approve_user' } do |f| %>
            <%= f.error_notification %>
            <%= f.input :approved, input_html: { onchange: "$(this.form).submit();", id: "user_approved_#{user.id}" } %>
          <% end %>
          <%= simple_form_for user, url: make_admin_user_path(user), remote: true, html: { id: "make_admin_user_#{user.id}", class: 'make_admin_user' } do |f| %>
            <%= f.error_notification %>
            <%= f.input :is_admin, input_html: { onchange: "$(this.form).submit();", id: "user_is_admin_#{user.id}" } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>